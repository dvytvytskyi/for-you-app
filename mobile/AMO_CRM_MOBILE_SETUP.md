# üì± AMO CRM Mobile Integration - –ü—ñ–¥—Å—É–º–æ–∫

## ‚úÖ –©–æ –∑—Ä–æ–±–ª–µ–Ω–æ

### 1. API –∫–ª—ñ—î–Ω—Ç (`mobile/api/amo-crm.ts`)
- ‚úÖ `getConnectionStatus()` - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- ‚úÖ `exchangeCode(code)` - –æ–±–º—ñ–Ω authorization code –Ω–∞ —Ç–æ–∫–µ–Ω–∏
- ‚úÖ `disconnect()` - –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è AMO CRM
- ‚úÖ `buildAmoAuthUrl()` - –ø–æ–±—É–¥–æ–≤–∞ OAuth URL
- ‚úÖ `getPipelines()` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–æ—Ä–æ–Ω–æ–∫
- ‚úÖ `getStages(pipelineId)` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –µ—Ç–∞–ø—ñ–≤

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- ‚úÖ `AmoCrmAuthScreen` - –µ–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó AMO CRM
- ‚úÖ `AmoCrmStatusBadge` - –±–µ–π–¥–∂ —Å—Ç–∞—Ç—É—Å—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- ‚úÖ `amo-crm/callback.tsx` - –µ–∫—Ä–∞–Ω –æ–±—Ä–æ–±–∫–∏ OAuth callback

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- ‚úÖ Deep linking –≤ `app.json`:
  - iOS: `associatedDomains`
  - Android: `intentFilters`
  - Scheme: `foryoure://amo-crm/callback`

### 4. CRM —Å—Ç–æ—Ä—ñ–Ω–∫–∞
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É AMO CRM –ø—Ä–∏ –∑–∞—Ö–æ–¥—ñ
- ‚úÖ –ü–æ–∫–∞–∑ –µ–∫—Ä–∞–Ω—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —è–∫—â–æ –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ
- ‚úÖ –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å –±–µ–π–¥–∂–∞ —è–∫—â–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ
- ‚úÖ –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

---

## üîÑ Flow –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

1. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞—Ö–æ–¥–∏—Ç—å –Ω–∞ CRM —Å—Ç–æ—Ä—ñ–Ω–∫—É**
   - –ü–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å: `GET /api/amo-crm/status`
   - –Ø–∫—â–æ `connected: false` ‚Üí –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è `AmoCrmAuthScreen`

2. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î "–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ AMO CRM"**
   - –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è OAuth URL –∑ `state` –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
   - –í—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä
   - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑—É—î—Ç—å—Å—è –≤ AMO CRM

3. **AMO CRM –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–∞ callback**
   - URL: `foryoure://amo-crm/callback?code=...&state=...`
   - –î–æ–¥–∞—Ç–æ–∫ –æ–±—Ä–æ–±–ª—è—î deep link
   - –í—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è `amo-crm/callback.tsx`

4. **–û–±–º—ñ–Ω code –Ω–∞ —Ç–æ–∫–µ–Ω–∏**
   - –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `POST /api/amo-crm/exchange-code`
   - Backend –æ–±–º—ñ–Ω—é—î code –Ω–∞ —Ç–æ–∫–µ–Ω–∏
   - –¢–æ–∫–µ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

5. **–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞ CRM —Å—Ç–æ—Ä—ñ–Ω–∫—É**
   - –°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
   - –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è –∑–≤–∏—á–∞–π–Ω–∏–π CRM –µ–∫—Ä–∞–Ω
   - –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å –±–µ–π–¥–∂

---

## ‚ö†Ô∏è –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞ –±–µ–∫–µ–Ω–¥—ñ

–î–∏–≤—ñ—Ç—å—Å—è: `backend/AMO_CRM_MOBILE_BACKEND_REQUIREMENTS.md`

**–û—Å–Ω–æ–≤–Ω—ñ –∑–º—ñ–Ω–∏:**
1. –î–æ–¥–∞—Ç–∏ `userId` –≤ `AmoCrmToken` entity
2. –û–Ω–æ–≤–∏—Ç–∏ endpoints –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–Ω–µ —Ç—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω—ñ–≤)
3. –î–æ–¥–∞—Ç–∏ –º–µ—Ç–æ–¥–∏: `getUserConnectionStatus()`, `exchangeCodeForUser()`, `disconnectUser()`

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
1. –ó–∞–π—Ç–∏ –Ω–∞ CRM —Å—Ç–æ—Ä—ñ–Ω–∫—É
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –µ–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
3. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ AMO CRM"
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä
5. –ê–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è –≤ AMO CRM
6. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—è –≤ –¥–æ–¥–∞—Ç–æ–∫
7. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Å—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è

### 2. –¢–µ—Å—Ç callback
1. –°–∏–º—É–ª—é–≤–∞—Ç–∏ deep link: `foryoure://amo-crm/callback?code=test123`
2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è callback –µ–∫—Ä–∞–Ω
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫

### 3. –¢–µ—Å—Ç –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
1. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ AMO CRM
2. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤ –±–µ–π–¥–∂—ñ
3. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Å—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è

---

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

### Deep Linking
- **Scheme:** `foryoure` (–≤–∂–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –≤ `app.json`)
- **Callback URL:** `foryoure://amo-crm/callback`
- **OAuth Redirect URI:** –ú–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ callback URL

### –ë–µ–∑–ø–µ–∫–∞
- `state` –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ SecureStore
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ `state` –ø—Ä–∏ callback (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –Ω–∞ –±–µ–∫–µ–Ω–¥—ñ)

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤
- Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î —Ç–æ–∫–µ–Ω–∏ —á–µ—Ä–µ–∑ `refresh_token`
- –ú–æ–±—ñ–ª—å–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥—ñ–π

---

## üîó –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

- [Expo Linking](https://docs.expo.dev/versions/latest/sdk/linking/)
- [Deep Linking –≤ React Native](https://reactnative.dev/docs/linking)
- [OAuth2 –≤ AMO CRM](https://www.amocrm.ru/developers/content/oauth/step-by-step)

---

**–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** –ì—Ä—É–¥–µ–Ω—å 2025
